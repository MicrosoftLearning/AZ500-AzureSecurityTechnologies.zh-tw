---
lab:
  title: 02 - Azure 原則
  module: Module 01 - Manage Identity and Access
ms.openlocfilehash: d49ce05e4620310d45317fe582bddb3aa511430b
ms.sourcegitcommit: 967cb50981ef07d731dd7548845a38385b3fb7fb
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/31/2022
ms.locfileid: "145955387"
---
# <a name="lab-02-azure-policy"></a>實驗室 02：Azure 原則
# <a name="student-lab-manual"></a>學生實驗室手冊

## <a name="lab-scenario"></a>實驗案例

系統要求您建立概念證明，示範如何使用 Azure 原則。 具體而言，您需要：

- 建立允許的位置原則，確保只在特定區域中建立資源。
- 測試並確保資源只在[允許的位置]中建立

> 針對此實驗室中所有的資源，我們使用 **美國東部** 區域。 請與講師確認這是課程中要使用的區域。 

## <a name="lab-objectives"></a>實驗室目標

在本實驗室中，您會完成下列練習：

- 練習 1：實作 Azure 原則。 

## <a name="azure-policy-diagram"></a>Azure 原則圖表

![image](https://user-images.githubusercontent.com/91347931/157511920-19c1f06c-86bd-440d-80ac-d96aa27aefff.png)

## <a name="instructions"></a>指示

### <a name="exercise-1-implement-azure-policy"></a>練習 1：實作 Azure 原則

#### <a name="estimated-timing-20-minutes"></a>預估時間：20 分鐘

在本練習中，您將會完成下列工作：

- 工作 1：建立 Azure 資源群組。 
- 工作 2：建立允許的位置原則指派。
- 工作 3：建立允許的位置原則指派可以運作。 

#### <a name="task-1-create-a-resource-group-for-the-lab"></a>工作 1：建立實驗室的資源群組。 

在此工作中，您會建立實驗室的資源群組。 

1. 登入 Azure 入口網站 **`https://portal.azure.com/`** 。

    >**注意**：登入 Azure 入口網站時使用的帳戶，必須在您用於這個實驗室的 Azure 訂閱中具有「擁有者」或「參與者」角色。

1. 按一下 Azure 入口網站右上方的第一個圖示，開啟 Cloud Shell。 如果出現提示，請選取 [PowerShell] 和 [建立儲存體]。

1. 確定在 [Cloud Shell] 窗格左上角的下拉式功能表中，選取 [PowerShell]。

1. 在 [Cloud Shell] 窗格的 PowerShell 工作階段中，執行下列操作建立資源群組 (請與講師確認位置參數的值)：

    ```powershell
    New-AzResourceGroup -Name AZ500LAB02 -Location 'East US'
    ```

1. 在 [Cloud Shell] 窗格的 PowerShell 工作階段中，執行下列操作列出資源群組，並確認已建立新的資源群組：

    ```powershell
    Get-AzResourceGroup | format-table
    ```

1. 關閉 [Cloud Shell]。

#### <a name="task-2-create-an-allowed-locations-policy-assignment"></a>工作 2：建立允許的位置原則指派。

在此工作中，您會建立允許的位置原則指派，並指定原則使用的 Azure 區域。 

1. 在 Azure 入口網站中，在 Azure 入口網站頁面頂端的 [搜尋資源、服務和文件] 文字輸入框中，輸入 **原則**，然後按 **Enter** 鍵。

1. 在 [原則] 刀鋒視窗的 [製作] 區段中，選取 [定義]。

1. 請花一些時間瀏覽內建定義。 使用 [類別] 下拉式清單篩選原則清單。

1. 在 [搜尋] 文字輸入框中，輸入 **允許的位置**。 

   >**注意**：**允許的位置** 原則讓您限制資源，而不是資源群組的位置。 若要限制資源群組的位置，請使用 **資源群組的允許位置** 原則。

1. 按一下 [允許的位置] 原則定義，顯示詳細資料。 

   >**注意**：此原則定義採用位置陣列作為參數。 原則規則是「if-then」陳述式。 「if」子句會檢查資源位置是否包含在參數清單中，如果不是，「then」子句會拒絕資源建立，或將現有的資源標示為不符合規範。

1. 在 [允許的位置] 刀鋒視窗上，按一下 [指派]。

1. 在 [允許的位置] 刀鋒視窗的 [基本] 索引標籤上，按一下 [範圍] 文字輸入框旁的省略符號 (…) 按鈕，然後在 [範圍] 刀鋒視窗上指定下列設定：

   |設定|值|
   |---|---|
   |訂用帳戶|Azure 訂閱的名稱|
   |資源群組|**AZ500LAB02**|

1. 按一下 [選取]。

1. 在 [允許的位置] 刀鋒視窗的 [基本] 索引標籤上，指定下列設定 (其他設定維持預設值)：

   |設定|值|
   |---|---|
   |指派名稱|**允許英國南部的 AZ500LAB02**|
   |描述|**僅允許在英國南部的 AZ500LAB02 中建立資源**|
   |強制執行原則|**已啟用**|

1. 按一下 [下一步] 。

1. 在 [允許的位置] 刀鋒視窗的 [參數] 索引標籤上，在 [允許的位置] 下拉式清單中，選取 [英國南部] 作為唯一允許的位置。 

   >**注意**：您可以選取多個位置。 如果原則需要一組不同的參數，此索引標籤會提供這些選取項目。 

1. 按一下 [檢閱 + 建立]，接著按 [建立] 建立原則指派。 

   >**注意**：您會看到指派成功，及指派大約需要 30 分鐘才能完成的通知。

   >**注意**：Azure 原則指派最多可能需要 30 分鐘才會生效的原因是，必須全域複寫。 這通常只需幾分鐘。  如果下一個工作失敗，請等候幾分鐘，然後再次嘗試這些步驟。

#### <a name="task-3-test-the-allowed-locations-policy-assignment"></a>工作 3：測試允許的位置原則指派

在此工作中，您會測試允許的位置原則指派。 

1. 在 Azure 入口網站中，在 Azure 入口網站頁面頂端的 [搜尋資源、服務和文件] 文字輸入框中，輸入 **虛擬網路**，然後按 **Enter** 鍵。

1. 在 [虛擬網路] 刀鋒視窗中，按一下 [+ 建立]。

   >**注意**：首先，您會嘗試在美國東部建立虛擬網路。 因為這不是允許的位置，所以會封鎖要求。 

1. 在 [建立虛擬網路] 刀鋒視窗的 [基本] 索引標籤上，指定下列設定 (其他設定維持預設值)：

    |設定|值|
    |---|---|
    |資源群組|**AZ500LAB02**|
    |名稱|**myVnet**|
    |區域|**(美國) 美國東部**|

1. 按一下 [檢閱 + 建立]。 

1. 在 [建立虛擬網路] 刀鋒視窗的 [檢閱 + 建立] 索引標籤上，記下 **驗證失敗** 的訊息。 

    > **注意**：如果 **驗證失敗** 警告未出現，請按一下 [上一步]，並等候幾分鐘。

1. 在 [基本] 索引標籤上，按一下錯誤訊息連結，開啟 [原則指派] 刀鋒視窗。 您會看到限制位置的原則指派。

1. 關閉 [原則指派] 刀鋒視窗，在 [建立虛擬網路] 刀鋒視窗上，按一下 [基本] 索引標籤，然後在 [區域] 下拉式清單中，選取 [(歐洲) 英國南部]。

1. 按一下 [檢閱 + 建立]，確認已通過驗證，按一下 [建立]，然後確認已成功建立虛擬網路。 

> 練習成果：在此練習中，您已了解如何選取內建原則定義套用 Azure 原則，並指派原則至資源群組。

**清除資源**

> 請記得移除您不再使用的任何新建 Azure 資源。 移除未使用的資源，確保您不會收到非預期的費用。

1. 在 Azure 入口網站中，按一下 Azure 入口網站右上方的第一圖示，開啟 [Cloud Shell]。 如果出現提示，請按一下 [重新連線]。

1. 在 [Cloud Shell] 窗格的 PowerShell 工作階段中，執行下列操作，移除您在此實驗室中建立的資源群組：
  
    ```powershell
    Remove-AzResourceGroup -Name "AZ500LAB02" -Force -AsJob
    ```
1.  關閉 [Cloud Shell] 窗格。 
  
1. 在 Azure 入口網站中，在 Azure 入口網站頁面頂端的 [搜尋資源、服務和文件] 文字輸入框中，輸入 **原則**，然後按 **Enter** 鍵。

1. 在 [編寫] 區段中，選取 [**指派**]。

1. 在指派清單中，選取您在此實驗室中建立的 **允許的位置** 原則名稱。

1. 在原則指派上，選取 [刪除指派]，然後選取 [是]。
